---
description: designing database schema or creating migrations
globs: 
alwaysApply: false
---
## ğŸ¯ **Goals:**
- Create initial schema for decentralized FDA. Don't worry about migrations. This is the initial schema
- Don't prefix files or folders with numbers
- Make sure each table and view is stored in its own SQL file. Do not put multiple tables or views in the same sql file
- Explicitly clear, intuitive, self-documenting naming conventions.
- Zero data duplication; simplest possible row-level security (RLS).
- Explicitly unified treatments/outcomes as **variables**.
- Explicitly unified numeric time-series data as **measurements**.
- No ambiguous prefixes (`user_`) in naming.
- Intermediate relational tables explicitly named by ownership relationship (`parent_child`).
- Avoid overly complex or overloaded schemas.
- Migration folder names must explicitly match schema names (e.g., migrations/150_global = global schema).

## ğŸ—‚ï¸ **Schema Structure**

```
 migrations/
    â”œâ”€â”€ reference/          # schema = reference
        â”œâ”€â”€ variables
        â”œâ”€â”€ variables_synonyms
        â””â”€â”€ units_of_measurement
    â”œâ”€â”€ global/            # schema = global
        â”œâ”€â”€ treatment_rankings
        â””â”€â”€ variable_global_stats
    â”œâ”€â”€ cohort/           # schema = cohort
        â”œâ”€â”€ trials
        â”œâ”€â”€ trial_phases
        â”œâ”€â”€ protocols
        â”œâ”€â”€ outcomes
        â”œâ”€â”€ trials_participants
        â”œâ”€â”€ protocols_variables
        â””â”€â”€ variable_group_stats
    â”œâ”€â”€ personal/         # schema = personal
        â”œâ”€â”€ trials
        â”œâ”€â”€ trial_phases
        â”œâ”€â”€ measurements
        â”œâ”€â”€ users_variables (with minimal user settings)
        â””â”€â”€ variable_user_stats
    â”œâ”€â”€ core/            # schema = core
        â”œâ”€â”€ users
        â”œâ”€â”€ audit_logs
        â”œâ”€â”€ permissions
        â”œâ”€â”€ groups_users
        â””â”€â”€ permissions_users
    â””â”€â”€ commerce/        # schema = commerce
        â”œâ”€â”€ orders
        â”œâ”€â”€ inventory
        â”œâ”€â”€ orders_products
        â””â”€â”€ shipments_orders
```

## ğŸ“‹ **Checklist**

Verify explicitly for every new table/view:

âœ… Schema explicitly selected from decision tree.  
âœ… Table or view explicitly chosen.  
âœ… naming without prefixes explicitly followed.  
âœ… `[parent_child]` relational table naming explicitly used.  
âœ… Unified variable & measurement handling.  
âœ… Explicitly simplify user variable settings (within relational or dedicated table).  
âœ… Explicitly enforce default units explicitly.  
âœ… RLS explicitly clear and simple.
âœ… Migration folder name explicitly matches schema name. 